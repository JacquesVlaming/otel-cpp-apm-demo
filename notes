
g++ -std=c++17 -shared -fPIC libotel_preload.cpp -o libotel_preload.so \
  -I$HOME/otel-cpp-apm-demo/otel-cpp/install/include \
  -L$HOME/otel-cpp-apm-demo/otel-cpp/install/lib \
  -L$HOME/otel-cpp-apm-demo/otel-cpp/install/lib64 \
  -lopentelemetry_exporter_otlp_grpc \
  -lopentelemetry_trace \
  -lgrpc++ -lgrpc -ldl -lpthread \
  -Wl,-rpath,$HOME/otel-cpp-apm-demo/otel-cpp/install/lib:$HOME/otel-cpp/install/lib64


export LD_LIBRARY_PATH=$HOME/otel-cpp-apm-demo/otel-cpp/install/lib:$LD_LIBRARY_PATH


cmake .. -DBUILD_SHARED_LIBS=ON -DWITH_OTLP_GRPC=ON -DCMAKE_INSTALL_PREFIX=$HOME/otel-cpp-apm-demo/otel-cpp/install -DWITH_EXAMPLES=OFF -DBUILD_TESTING=OFF
make -j$(nproc)
sudo make install
sudo ldconfig


export LD_LIBRARY_PATH=$HOME/otel-cpp-apm-demo/otel-cpp/install/lib64:$LD_LIBRARY_PATH
export LD_PRELOAD=$HOME/otel-cpp-apm-demo/libotel_preload.so
./ads_server
